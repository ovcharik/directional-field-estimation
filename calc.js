(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
importScripts('./libs.js');

new Producer(self, function(data) {
  var angle, cellH, cellW, coh, diff, dx, dy, gsx, gsy, gx, gxx, gxy, gy, gyy, h, i, j, k, l, len, len1, length, m, max, maxC, maxL, min, minC, minL, n, o, p, pp, px, py, rH, rW, ref, ref1, ref2, ref3, ref4, ref5, ref6, rp, sobelx, sobely, v, w, x, y;
  min = function(v1, v2) {
    if (v1 < v2) {
      return v1;
    } else {
      return v2;
    }
  };
  max = function(v1, v2) {
    if (v1 > v2) {
      return v1;
    } else {
      return v2;
    }
  };
  sobelx = data.x;
  sobely = data.y;
  w = sobelx.width;
  h = sobelx.height;
  dx = sobelx.data;
  dy = sobely.data;
  cellW = data.cellW;
  cellH = data.cellH;
  rW = Math.floor(w / cellW);
  rH = Math.floor(h / cellH);
  length = new Float32Array(rW * rH);
  angle = new Float32Array(rW * rH);
  coh = new Float32Array(rW * rH);
  minL = Infinity;
  maxL = -Infinity;
  minC = Infinity;
  maxC = -Infinity;
  for (y = k = 0, ref = rH; 0 <= ref ? k < ref : k > ref; y = 0 <= ref ? ++k : --k) {
    for (x = l = 0, ref1 = rW; 0 <= ref1 ? l < ref1 : l > ref1; x = 0 <= ref1 ? ++l : --l) {
      rp = y * rW + x;
      ref2 = [0, 0, 0, 0, 0], gxx = ref2[0], gyy = ref2[1], gxy = ref2[2], gsx = ref2[3], gsy = ref2[4];
      for (i = m = ref3 = y * cellH, ref4 = (y + 1) * cellH; ref3 <= ref4 ? m < ref4 : m > ref4; i = ref3 <= ref4 ? ++m : --m) {
        for (j = n = ref5 = x * cellW, ref6 = (x + 1) * cellW; ref5 <= ref6 ? n < ref6 : n > ref6; j = ref5 <= ref6 ? ++n : --n) {
          py = max(0, min(h - 1, i));
          px = max(0, min(w - 1, j));
          pp = py * w + px;
          gx = dx[pp];
          gy = dy[pp];
          gxx += gx * gx;
          gyy += gy * gy;
          gxy += gx * gy;
          gsx += gx * gx - gy * gy;
          gsy += 2 * gx * gy;
        }
      }
      angle[rp] = (-0.5 * Math.atan2(gsy, gsx)) % (2 * Math.PI) + Math.PI / 2;
      length[rp] = Math.sqrt(gsx * gsx + gsy * gsy);
      if (length[rp] < minL) {
        minL = length[rp];
      }
      if (length[rp] > maxL) {
        maxL = length[rp];
      }
      diff = gxx - gyy;
      coh[rp] = Math.sqrt(diff * diff + 4 * gxy * gxy) / (gxx + gyy);
      if (coh[rp] < minC) {
        minC = coh[rp];
      }
      if (coh[rp] > maxC) {
        maxC = coh[rp];
      }
    }
  }
  maxL -= minL;
  for (i = o = 0, len = length.length; o < len; i = ++o) {
    v = length[i];
    length[i] = (v - minL) / maxL;
  }
  maxC -= minC;
  for (i = p = 0, len1 = coh.length; p < len1; i = ++p) {
    v = coh[i];
    coh[i] = (v - minC) / maxC;
  }
  return {
    length: length,
    angle: angle,
    coh: coh
  };
});



},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9ncnVudC1icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9tb3YvZGV2L2RmZS9zcmMvd29ya2Vycy9jYWxjLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBLGFBQUEsQ0FBYyxXQUFkLENBQUEsQ0FBQTs7QUFBQSxJQUVJLFFBQUEsQ0FBUyxJQUFULEVBQWUsU0FBQyxJQUFELEdBQUE7QUFFakIsTUFBQSxvUEFBQTtBQUFBLEVBQUEsR0FBQSxHQUFNLFNBQUMsRUFBRCxFQUFLLEVBQUwsR0FBQTtBQUFZLElBQUEsSUFBSSxFQUFBLEdBQUssRUFBVDthQUFrQixHQUFsQjtLQUFBLE1BQUE7YUFBMEIsR0FBMUI7S0FBWjtFQUFBLENBQU4sQ0FBQTtBQUFBLEVBQ0EsR0FBQSxHQUFNLFNBQUMsRUFBRCxFQUFLLEVBQUwsR0FBQTtBQUFZLElBQUEsSUFBSSxFQUFBLEdBQUssRUFBVDthQUFrQixHQUFsQjtLQUFBLE1BQUE7YUFBMEIsR0FBMUI7S0FBWjtFQUFBLENBRE4sQ0FBQTtBQUFBLEVBR0EsTUFBQSxHQUFTLElBQUksQ0FBQyxDQUhkLENBQUE7QUFBQSxFQUlBLE1BQUEsR0FBUyxJQUFJLENBQUMsQ0FKZCxDQUFBO0FBQUEsRUFNQSxDQUFBLEdBQUksTUFBTSxDQUFDLEtBTlgsQ0FBQTtBQUFBLEVBT0EsQ0FBQSxHQUFJLE1BQU0sQ0FBQyxNQVBYLENBQUE7QUFBQSxFQVNBLEVBQUEsR0FBSyxNQUFNLENBQUMsSUFUWixDQUFBO0FBQUEsRUFVQSxFQUFBLEdBQUssTUFBTSxDQUFDLElBVlosQ0FBQTtBQUFBLEVBWUEsS0FBQSxHQUFRLElBQUksQ0FBQyxLQVpiLENBQUE7QUFBQSxFQWFBLEtBQUEsR0FBUSxJQUFJLENBQUMsS0FiYixDQUFBO0FBQUEsRUFlQSxFQUFBLEdBQUssSUFBSSxDQUFDLEtBQUwsQ0FBVyxDQUFBLEdBQUksS0FBZixDQWZMLENBQUE7QUFBQSxFQWdCQSxFQUFBLEdBQUssSUFBSSxDQUFDLEtBQUwsQ0FBVyxDQUFBLEdBQUksS0FBZixDQWhCTCxDQUFBO0FBQUEsRUFrQkEsTUFBQSxHQUFhLElBQUEsWUFBQSxDQUFhLEVBQUEsR0FBSyxFQUFsQixDQWxCYixDQUFBO0FBQUEsRUFtQkEsS0FBQSxHQUFhLElBQUEsWUFBQSxDQUFhLEVBQUEsR0FBSyxFQUFsQixDQW5CYixDQUFBO0FBQUEsRUFvQkEsR0FBQSxHQUFhLElBQUEsWUFBQSxDQUFhLEVBQUEsR0FBSyxFQUFsQixDQXBCYixDQUFBO0FBQUEsRUFzQkEsSUFBQSxHQUFPLFFBdEJQLENBQUE7QUFBQSxFQXVCQSxJQUFBLEdBQU8sQ0FBQSxRQXZCUCxDQUFBO0FBQUEsRUF5QkEsSUFBQSxHQUFPLFFBekJQLENBQUE7QUFBQSxFQTBCQSxJQUFBLEdBQU8sQ0FBQSxRQTFCUCxDQUFBO0FBNEJBLE9BQVMsMkVBQVQsR0FBQTtBQUNFLFNBQVMsZ0ZBQVQsR0FBQTtBQUNFLE1BQUEsRUFBQSxHQUFLLENBQUEsR0FBSSxFQUFKLEdBQVMsQ0FBZCxDQUFBO0FBQUEsTUFDQSxPQUE0QixDQUFDLENBQUQsRUFBSSxDQUFKLEVBQU8sQ0FBUCxFQUFVLENBQVYsRUFBYSxDQUFiLENBQTVCLEVBQUMsYUFBRCxFQUFNLGFBQU4sRUFBVyxhQUFYLEVBQWdCLGFBQWhCLEVBQXFCLGFBRHJCLENBQUE7QUFHQSxXQUFTLGtIQUFULEdBQUE7QUFDRSxhQUFTLGtIQUFULEdBQUE7QUFDRSxVQUFBLEVBQUEsR0FBSyxHQUFBLENBQUksQ0FBSixFQUFPLEdBQUEsQ0FBSSxDQUFBLEdBQUUsQ0FBTixFQUFTLENBQVQsQ0FBUCxDQUFMLENBQUE7QUFBQSxVQUNBLEVBQUEsR0FBSyxHQUFBLENBQUksQ0FBSixFQUFPLEdBQUEsQ0FBSSxDQUFBLEdBQUUsQ0FBTixFQUFTLENBQVQsQ0FBUCxDQURMLENBQUE7QUFBQSxVQUVBLEVBQUEsR0FBSyxFQUFBLEdBQUssQ0FBTCxHQUFTLEVBRmQsQ0FBQTtBQUFBLFVBSUEsRUFBQSxHQUFLLEVBQUcsQ0FBQSxFQUFBLENBSlIsQ0FBQTtBQUFBLFVBS0EsRUFBQSxHQUFLLEVBQUcsQ0FBQSxFQUFBLENBTFIsQ0FBQTtBQUFBLFVBT0EsR0FBQSxJQUFPLEVBQUEsR0FBSyxFQVBaLENBQUE7QUFBQSxVQVFBLEdBQUEsSUFBTyxFQUFBLEdBQUssRUFSWixDQUFBO0FBQUEsVUFTQSxHQUFBLElBQU8sRUFBQSxHQUFLLEVBVFosQ0FBQTtBQUFBLFVBVUEsR0FBQSxJQUFPLEVBQUEsR0FBSyxFQUFMLEdBQVUsRUFBQSxHQUFLLEVBVnRCLENBQUE7QUFBQSxVQVdBLEdBQUEsSUFBTyxDQUFBLEdBQUksRUFBSixHQUFTLEVBWGhCLENBREY7QUFBQSxTQURGO0FBQUEsT0FIQTtBQUFBLE1Ba0JBLEtBQU0sQ0FBQSxFQUFBLENBQU4sR0FBWSxDQUFDLENBQUEsR0FBQSxHQUFPLElBQUksQ0FBQyxLQUFMLENBQVcsR0FBWCxFQUFnQixHQUFoQixDQUFSLENBQUEsR0FBZ0MsQ0FBQyxDQUFBLEdBQUksSUFBSSxDQUFDLEVBQVYsQ0FBaEMsR0FBZ0QsSUFBSSxDQUFDLEVBQUwsR0FBVSxDQWxCdEUsQ0FBQTtBQUFBLE1Bb0JBLE1BQU8sQ0FBQSxFQUFBLENBQVAsR0FBYSxJQUFJLENBQUMsSUFBTCxDQUFVLEdBQUEsR0FBTSxHQUFOLEdBQVksR0FBQSxHQUFNLEdBQTVCLENBcEJiLENBQUE7QUFxQkEsTUFBQSxJQUFzQixNQUFPLENBQUEsRUFBQSxDQUFQLEdBQWEsSUFBbkM7QUFBQSxRQUFBLElBQUEsR0FBUSxNQUFPLENBQUEsRUFBQSxDQUFmLENBQUE7T0FyQkE7QUFzQkEsTUFBQSxJQUFzQixNQUFPLENBQUEsRUFBQSxDQUFQLEdBQWEsSUFBbkM7QUFBQSxRQUFBLElBQUEsR0FBUSxNQUFPLENBQUEsRUFBQSxDQUFmLENBQUE7T0F0QkE7QUFBQSxNQXdCQSxJQUFBLEdBQU8sR0FBQSxHQUFNLEdBeEJiLENBQUE7QUFBQSxNQXlCQSxHQUFJLENBQUEsRUFBQSxDQUFKLEdBQVUsSUFBSSxDQUFDLElBQUwsQ0FBVyxJQUFBLEdBQU8sSUFBUCxHQUFjLENBQUEsR0FBSSxHQUFKLEdBQVUsR0FBbkMsQ0FBQSxHQUEyQyxDQUFDLEdBQUEsR0FBTSxHQUFQLENBekJyRCxDQUFBO0FBMEJBLE1BQUEsSUFBbUIsR0FBSSxDQUFBLEVBQUEsQ0FBSixHQUFVLElBQTdCO0FBQUEsUUFBQSxJQUFBLEdBQVEsR0FBSSxDQUFBLEVBQUEsQ0FBWixDQUFBO09BMUJBO0FBMkJBLE1BQUEsSUFBbUIsR0FBSSxDQUFBLEVBQUEsQ0FBSixHQUFVLElBQTdCO0FBQUEsUUFBQSxJQUFBLEdBQVEsR0FBSSxDQUFBLEVBQUEsQ0FBWixDQUFBO09BNUJGO0FBQUEsS0FERjtBQUFBLEdBNUJBO0FBQUEsRUE0REEsSUFBQSxJQUFRLElBNURSLENBQUE7QUE2REEsT0FBQSxnREFBQTtrQkFBQTtBQUFBLElBQUEsTUFBTyxDQUFBLENBQUEsQ0FBUCxHQUFZLENBQUMsQ0FBQSxHQUFJLElBQUwsQ0FBQSxHQUFhLElBQXpCLENBQUE7QUFBQSxHQTdEQTtBQUFBLEVBZ0VBLElBQUEsSUFBUSxJQWhFUixDQUFBO0FBaUVBLE9BQUEsK0NBQUE7ZUFBQTtBQUFBLElBQUEsR0FBSSxDQUFBLENBQUEsQ0FBSixHQUFTLENBQUMsQ0FBQSxHQUFJLElBQUwsQ0FBQSxHQUFhLElBQXRCLENBQUE7QUFBQSxHQWpFQTtTQW1FQTtBQUFBLElBQ0UsTUFBQSxFQUFRLE1BRFY7QUFBQSxJQUVFLEtBQUEsRUFBTyxLQUZUO0FBQUEsSUFHRSxHQUFBLEVBQUssR0FIUDtJQXJFaUI7QUFBQSxDQUFmLENBRkosQ0FBQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnRTY3JpcHRzICcuL2xpYnMuanMnXG5cbm5ldyBQcm9kdWNlciBzZWxmLCAoZGF0YSkgLT5cblxuICBtaW4gPSAodjEsIHYyKSAtPiBpZiAodjEgPCB2MikgdGhlbiB2MSBlbHNlIHYyXG4gIG1heCA9ICh2MSwgdjIpIC0+IGlmICh2MSA+IHYyKSB0aGVuIHYxIGVsc2UgdjJcblxuICBzb2JlbHggPSBkYXRhLnhcbiAgc29iZWx5ID0gZGF0YS55XG5cbiAgdyA9IHNvYmVseC53aWR0aFxuICBoID0gc29iZWx4LmhlaWdodFxuXG4gIGR4ID0gc29iZWx4LmRhdGFcbiAgZHkgPSBzb2JlbHkuZGF0YVxuXG4gIGNlbGxXID0gZGF0YS5jZWxsV1xuICBjZWxsSCA9IGRhdGEuY2VsbEhcblxuICByVyA9IE1hdGguZmxvb3IodyAvIGNlbGxXKVxuICBySCA9IE1hdGguZmxvb3IoaCAvIGNlbGxIKVxuXG4gIGxlbmd0aCA9IG5ldyBGbG9hdDMyQXJyYXkoclcgKiBySClcbiAgYW5nbGUgID0gbmV3IEZsb2F0MzJBcnJheShyVyAqIHJIKVxuICBjb2ggICAgPSBuZXcgRmxvYXQzMkFycmF5KHJXICogckgpXG5cbiAgbWluTCA9IEluZmluaXR5XG4gIG1heEwgPSAtSW5maW5pdHlcblxuICBtaW5DID0gSW5maW5pdHlcbiAgbWF4QyA9IC1JbmZpbml0eVxuXG4gIGZvciB5IGluIFswIC4uLiBySF1cbiAgICBmb3IgeCBpbiBbMCAuLi4gclddXG4gICAgICBycCA9IHkgKiByVyArIHhcbiAgICAgIFtneHgsIGd5eSwgZ3h5LCBnc3gsIGdzeV0gPSBbMCwgMCwgMCwgMCwgMF1cblxuICAgICAgZm9yIGkgaW4gWyB5ICogY2VsbEggLi4uICh5ICsgMSkgKiBjZWxsSCBdXG4gICAgICAgIGZvciBqIGluIFsgeCAqIGNlbGxXIC4uLiAoeCArIDEpICogY2VsbFcgXVxuICAgICAgICAgIHB5ID0gbWF4KDAsIG1pbihoLTEsIGkpKVxuICAgICAgICAgIHB4ID0gbWF4KDAsIG1pbih3LTEsIGopKVxuICAgICAgICAgIHBwID0gcHkgKiB3ICsgcHhcblxuICAgICAgICAgIGd4ID0gZHhbcHBdXG4gICAgICAgICAgZ3kgPSBkeVtwcF1cblxuICAgICAgICAgIGd4eCArPSBneCAqIGd4XG4gICAgICAgICAgZ3l5ICs9IGd5ICogZ3lcbiAgICAgICAgICBneHkgKz0gZ3ggKiBneVxuICAgICAgICAgIGdzeCArPSBneCAqIGd4IC0gZ3kgKiBneVxuICAgICAgICAgIGdzeSArPSAyICogZ3ggKiBneVxuXG4gICAgICBhbmdsZVtycF0gPSAoLTAuNSAqIE1hdGguYXRhbjIoZ3N5LCBnc3gpKSAlICgyICogTWF0aC5QSSkgKyBNYXRoLlBJIC8gMlxuXG4gICAgICBsZW5ndGhbcnBdID0gTWF0aC5zcXJ0KGdzeCAqIGdzeCArIGdzeSAqIGdzeSlcbiAgICAgIG1pbkwgID0gbGVuZ3RoW3JwXSBpZiBsZW5ndGhbcnBdIDwgbWluTFxuICAgICAgbWF4TCAgPSBsZW5ndGhbcnBdIGlmIGxlbmd0aFtycF0gPiBtYXhMXG5cbiAgICAgIGRpZmYgPSBneHggLSBneXlcbiAgICAgIGNvaFtycF0gPSBNYXRoLnNxcnQoIGRpZmYgKiBkaWZmICsgNCAqIGd4eSAqIGd4eSApIC8gKGd4eCArIGd5eSlcbiAgICAgIG1pbkMgID0gY29oW3JwXSBpZiBjb2hbcnBdIDwgbWluQ1xuICAgICAgbWF4QyAgPSBjb2hbcnBdIGlmIGNvaFtycF0gPiBtYXhDXG5cbiAgIyBsZW5ndGggbm9ybWFsaXphdGlvblxuICBtYXhMIC09IG1pbkxcbiAgbGVuZ3RoW2ldID0gKHYgLSBtaW5MKSAvIG1heEwgZm9yIHYsIGkgaW4gbGVuZ3RoXG5cbiAgIyBjb2hlcmVuY3kgbm9ybWFsaXphdGlvblxuICBtYXhDIC09IG1pbkNcbiAgY29oW2ldID0gKHYgLSBtaW5DKSAvIG1heEMgZm9yIHYsIGkgaW4gY29oXG5cbiAge1xuICAgIGxlbmd0aDogbGVuZ3RoXG4gICAgYW5nbGU6IGFuZ2xlXG4gICAgY29oOiBjb2hcbiAgfVxuXG5cblxuXG5cbiJdfQ==
