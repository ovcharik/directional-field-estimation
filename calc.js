(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var calcAngle;

importScripts('./libs.js');

calcAngle = function(x, y) {
  var a;
  a = (-0.5 * Math.atan2(x, y)) % (2 * Math.PI) + Math.PI / 2;
  return a;
};

new Producer(self, function(data) {
  var angle, cellH, cellW, coh, diff, gsx, gsy, gx, gxx, gxy, gy, gyy, h, i, j, k, l, len, len1, length, m, maxC, maxL, minC, minL, n, o, p, pp, px, py, rH, rW, ref, ref1, ref2, ref3, ref4, ref5, ref6, rp, sobelx, sobely, v, w, x, y;
  sobelx = data.x;
  sobely = data.y;
  w = sobelx.width;
  h = sobelx.height;
  cellW = data.cellW;
  cellH = data.cellH;
  rW = Math.floor(w / cellW);
  rH = Math.floor(h / cellH);
  length = new Array(rW * rH);
  angle = new Array(rW * rH);
  coh = new Array(rW * rH);
  minL = Infinity;
  maxL = -Infinity;
  minC = Infinity;
  maxC = -Infinity;
  for (y = k = 0, ref = rH; 0 <= ref ? k < ref : k > ref; y = 0 <= ref ? ++k : --k) {
    for (x = l = 0, ref1 = rW; 0 <= ref1 ? l < ref1 : l > ref1; x = 0 <= ref1 ? ++l : --l) {
      rp = y * rW + x;
      ref2 = [0, 0, 0, 0, 0], gxx = ref2[0], gyy = ref2[1], gxy = ref2[2], gsx = ref2[3], gsy = ref2[4];
      for (i = m = ref3 = y * cellH, ref4 = (y + 1) * cellH; ref3 <= ref4 ? m < ref4 : m > ref4; i = ref3 <= ref4 ? ++m : --m) {
        for (j = n = ref5 = x * cellW, ref6 = (x + 1) * cellW; ref5 <= ref6 ? n < ref6 : n > ref6; j = ref5 <= ref6 ? ++n : --n) {
          py = _.max([0, _.min([h - 1, i])]);
          px = _.max([0, _.min([w - 1, j])]);
          pp = py * w + px;
          gx = sobelx.data[pp];
          gy = sobely.data[pp];
          gxx += gx * gx;
          gyy += gy * gy;
          gxy += gx * gy;
          gsx += gx * gx - gy * gy;
          gsy += 2 * gx * gy;
        }
      }
      angle[rp] = calcAngle(gsy, gsx);
      length[rp] = Math.sqrt(gsx * gsx + gsy * gsy);
      if (length[rp] < minL) {
        minL = length[rp];
      }
      if (length[rp] > maxL) {
        maxL = length[rp];
      }
      diff = gxx - gyy;
      coh[rp] = Math.sqrt(diff * diff + 4 * gxy * gxy) / (gxx + gyy);
      if (coh[rp] < minC) {
        minC = coh[rp];
      }
      if (coh[rp] > maxC) {
        maxC = coh[rp];
      }
    }
  }
  maxL -= minL;
  for (i = o = 0, len = length.length; o < len; i = ++o) {
    v = length[i];
    length[i] = (v - minL) / maxL;
  }
  maxC -= minC;
  for (i = p = 0, len1 = coh.length; p < len1; i = ++p) {
    v = coh[i];
    coh[i] = (v - minC) / maxC;
  }
  return {
    length: length,
    angle: angle,
    coh: coh
  };
});



},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9ncnVudC1icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9tb3YvZGV2L2RmZS9zcmMvd29ya2Vycy9jYWxjLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBLElBQUEsU0FBQTs7QUFBQSxhQUFBLENBQWMsV0FBZCxDQUFBLENBQUE7O0FBQUEsU0FFQSxHQUFZLFNBQUMsQ0FBRCxFQUFJLENBQUosR0FBQTtBQUNWLE1BQUEsQ0FBQTtBQUFBLEVBQUEsQ0FBQSxHQUFLLENBQUMsQ0FBQSxHQUFBLEdBQU8sSUFBSSxDQUFDLEtBQUwsQ0FBVyxDQUFYLEVBQWMsQ0FBZCxDQUFSLENBQUEsR0FBNEIsQ0FBQyxDQUFBLEdBQUksSUFBSSxDQUFDLEVBQVYsQ0FBNUIsR0FBNEMsSUFBSSxDQUFDLEVBQUwsR0FBVSxDQUEzRCxDQUFBO1NBRUEsRUFIVTtBQUFBLENBRlosQ0FBQTs7QUFBQSxJQU9JLFFBQUEsQ0FBUyxJQUFULEVBQWUsU0FBQyxJQUFELEdBQUE7QUFFakIsTUFBQSxrT0FBQTtBQUFBLEVBQUEsTUFBQSxHQUFTLElBQUksQ0FBQyxDQUFkLENBQUE7QUFBQSxFQUNBLE1BQUEsR0FBUyxJQUFJLENBQUMsQ0FEZCxDQUFBO0FBQUEsRUFHQSxDQUFBLEdBQUksTUFBTSxDQUFDLEtBSFgsQ0FBQTtBQUFBLEVBSUEsQ0FBQSxHQUFJLE1BQU0sQ0FBQyxNQUpYLENBQUE7QUFBQSxFQU1BLEtBQUEsR0FBUSxJQUFJLENBQUMsS0FOYixDQUFBO0FBQUEsRUFPQSxLQUFBLEdBQVEsSUFBSSxDQUFDLEtBUGIsQ0FBQTtBQUFBLEVBU0EsRUFBQSxHQUFLLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBQSxHQUFJLEtBQWYsQ0FUTCxDQUFBO0FBQUEsRUFVQSxFQUFBLEdBQUssSUFBSSxDQUFDLEtBQUwsQ0FBVyxDQUFBLEdBQUks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LENBQUMsR0FBQSxHQUFNLEdBQVAsQ0F6QnJELENBQUE7QUEwQkEsTUFBQSxJQUFtQixHQUFJLENBQUEsRUFBQSxDQUFKLEdBQVUsSUFBN0I7QUFBQSxRQUFBLElBQUEsR0FBUSxHQUFJLENBQUEsRUFBQSxDQUFaLENBQUE7T0ExQkE7QUEyQkEsTUFBQSxJQUFtQixHQUFJLENBQUEsRUFBQSxDQUFKLEdBQVUsSUFBN0I7QUFBQSxRQUFBLElBQUEsR0FBUSxHQUFJLENBQUEsRUFBQSxDQUFaLENBQUE7T0E1QkY7QUFBQSxLQURGO0FBQUEsR0F0QkE7QUFBQSxFQXNEQSxJQUFBLElBQVEsSUF0RFIsQ0FBQTtBQXVEQSxPQUFBLGdEQUFBO2tCQUFBO0FBQUEsSUFBQSxNQUFPLENBQUEsQ0FBQSxDQUFQLEdBQVksQ0FBQyxDQUFBLEdBQUksSUFBTCxDQUFBLEdBQWEsSUFBekIsQ0FBQTtBQUFBLEdBdkRBO0FBQUEsRUEwREEsSUFBQSxJQUFRLElBMURSLENBQUE7QUEyREEsT0FBQSwrQ0FBQTtlQUFBO0FBQUEsSUFBQSxHQUFJLENBQUEsQ0FBQSxDQUFKLEdBQVMsQ0FBQyxDQUFBLEdBQUksSUFBTCxDQUFBLEdBQWEsSUFBdEIsQ0FBQTtBQUFBLEdBM0RBO0FBNkRBLFNBQU87QUFBQSxJQUNMLE1BQUEsRUFBUSxNQURIO0FBQUEsSUFFTCxLQUFBLEVBQU8sS0FGRjtBQUFBLElBR0wsR0FBQSxFQUFLLEdBSEE7R0FBUCxDQS9EaUI7QUFBQSxDQUFmLENBUEosQ0FBQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnRTY3JpcHRzICcuL2xpYnMuanMnXG5cbmNhbGNBbmdsZSA9ICh4LCB5KSAtPlxuICBhICA9ICgtMC41ICogTWF0aC5hdGFuMih4LCB5KSkgJSAoMiAqIE1hdGguUEkpICsgTWF0aC5QSSAvIDJcbiAgIyBhICs9IE1hdGguUEkgaWYgYSA8IDBcbiAgYVxuXG5uZXcgUHJvZHVjZXIgc2VsZiwgKGRhdGEpIC0+XG5cbiAgc29iZWx4ID0gZGF0YS54XG4gIHNvYmVseSA9IGRhdGEueVxuXG4gIHcgPSBzb2JlbHgud2lkdGhcbiAgaCA9IHNvYmVseC5oZWlnaHRcblxuICBjZWxsVyA9IGRhdGEuY2VsbFdcbiAgY2VsbEggPSBkYXRhLmNlbGxIXG5cbiAgclcgPSBNYXRoLmZsb29yKHcgLyBjZWxsVylcbiAgckggPSBNYXRoLmZsb29yKGggLyBjZWxsSClcblxuICBsZW5ndGggPSBuZXcgQXJyYXkoclcgKiBySClcbiAgYW5nbGUgID0gbmV3IEFycmF5KHJXICogckgpXG4gIGNvaCAgICA9IG5ldyBBcnJheShyVyAqIHJIKVxuXG4gIG1pbkwgPSBJbmZpbml0eVxuICBtYXhMID0gLUluZmluaXR5XG5cbiAgbWluQyA9IEluZmluaXR5XG4gIG1heEMgPSAtSW5maW5pdHlcblxuICBmb3IgeSBpbiBbMCAuLi4gckhdXG4gICAgZm9yIHggaW4gWzAgLi4uIHJXXVxuICAgICAgcnAgPSB5ICogclcgKyB4XG4gICAgICBbZ3h4LCBneXksIGd4eSwgZ3N4LCBnc3ldID0gWzAsIDAsIDAsIDAsIDBdXG5cbiAgICAgIGZvciBpIGluIFsgeSAqIGNlbGxIIC4uLiAoeSArIDEpICogY2VsbEggXVxuICAgICAgICBmb3IgaiBpbiBbIHggKiBjZWxsVyAuLi4gKHggKyAxKSAqIGNlbGxXIF1cbiAgICAgICAgICBweSA9IF8ubWF4IChbMCwgXy5taW4oW2gtMSwgaV0pXSlcbiAgICAgICAgICBweCA9IF8ubWF4IChbMCwgXy5taW4oW3ctMSwgal0pXSlcbiAgICAgICAgICBwcCA9IHB5ICogdyArIHB4XG5cbiAgICAgICAgICBneCA9IHNvYmVseC5kYXRhW3BwXVxuICAgICAgICAgIGd5ID0gc29iZWx5LmRhdGFbcHBdXG5cbiAgICAgICAgICBneHggKz0gZ3ggKiBneFxuICAgICAgICAgIGd5eSArPSBneSAqIGd5XG4gICAgICAgICAgZ3h5ICs9IGd4ICogZ3lcbiAgICAgICAgICBnc3ggKz0gZ3ggKiBneCAtIGd5ICogZ3lcbiAgICAgICAgICBnc3kgKz0gMiAqIGd4ICogZ3lcblxuICAgICAgYW5nbGVbcnBdID0gY2FsY0FuZ2xlKGdzeSwgZ3N4KVxuXG4gICAgICBsZW5ndGhbcnBdID0gTWF0aC5zcXJ0KGdzeCAqIGdzeCArIGdzeSAqIGdzeSlcbiAgICAgIG1pbkwgID0gbGVuZ3RoW3JwXSBpZiBsZW5ndGhbcnBdIDwgbWluTFxuICAgICAgbWF4TCAgPSBsZW5ndGhbcnBdIGlmIGxlbmd0aFtycF0gPiBtYXhMXG5cbiAgICAgIGRpZmYgPSBneHggLSBneXlcbiAgICAgIGNvaFtycF0gPSBNYXRoLnNxcnQoIGRpZmYgKiBkaWZmICsgNCAqIGd4eSAqIGd4eSApIC8gKGd4eCArIGd5eSlcbiAgICAgIG1pbkMgID0gY29oW3JwXSBpZiBjb2hbcnBdIDwgbWluQ1xuICAgICAgbWF4QyAgPSBjb2hbcnBdIGlmIGNvaFtycF0gPiBtYXhDXG5cbiAgIyBsZW5ndGggbm9ybWFsaXphdGlvblxuICBtYXhMIC09IG1pbkxcbiAgbGVuZ3RoW2ldID0gKHYgLSBtaW5MKSAvIG1heEwgZm9yIHYsIGkgaW4gbGVuZ3RoXG5cbiAgIyBjb2hlcmVuY3kgbm9ybWFsaXphdGlvblxuICBtYXhDIC09IG1pbkNcbiAgY29oW2ldID0gKHYgLSBtaW5DKSAvIG1heEMgZm9yIHYsIGkgaW4gY29oXG5cbiAgcmV0dXJuIHtcbiAgICBsZW5ndGg6IGxlbmd0aFxuICAgIGFuZ2xlOiBhbmdsZVxuICAgIGNvaDogY29oXG4gIH1cblxuXG5cblxuXG4iXX0=
